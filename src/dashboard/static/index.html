<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heisenberg Grid</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css?v=6">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>
</head>
<body>

<!-- ─── Header ─── -->
<div class="header">
    <div class="header-left">
        <div class="logo">
            <div class="logo-icon">Br</div>
            <span>Heisenberg<span style="color:var(--text-muted);font-weight:400;font-size:11px;margin-left:6px">Grid</span></span>
        </div>
        <div class="view-tabs">
            <button class="view-tab" id="view-tab-spot" onclick="switchView('spot')">Spot</button>
            <button class="view-tab active" id="view-tab-futures" onclick="switchView('futures')">⚡ Futures</button>
        </div>
        <select id="pair-selector" class="pair-badge" onchange="selectPair(this.value)">
            <option value="__all__">All Pairs</option>
        </select>
    </div>
    <div class="header-center">
        <div class="price-display">
            <div class="label">Current Price</div>
            <div class="value" id="current-price">$0.00</div>
        </div>
    </div>
    <div class="header-right">
        <div class="trailing-badge" id="trailing-badge" style="display:none">COOKING</div>
        <div class="risk-alert" id="risk-alert">DANGER</div>
        <div class="status-pill status-idle" id="status-pill">
            <span class="dot"></span>
            <span id="status-text">IDLE</span>
        </div>
        <button class="btn-start" id="btn-start" onclick="botAction('start')">Cook</button>
        <button class="btn-stop" id="btn-stop" onclick="botAction('stop')">Shut Down</button>
    </div>
</div>

<!-- ─── Main Layout ─── -->
<div class="main" id="main-view" style="display:none">

    <!-- Stat Bar -->
    <div class="stat-bar">
        <div class="stat-item">
            <span class="label">Empire</span>
            <span class="value" id="total-equity">$0.00</span>
        </div>
        <div class="stat-item">
            <span class="label">Cash Reserve</span>
            <span class="value" id="available-usd">$0.00</span>
        </div>
        <div class="stat-item">
            <span class="label">Realized P&L</span>
            <span class="value" id="realized-pnl" style="color:var(--green)">$0.00</span>
        </div>
        <div class="stat-item">
            <span class="label">Unrealized P&L</span>
            <span class="value" id="unrealized-pnl" style="color:var(--text-secondary)">$0.00</span>
        </div>
        <div class="stat-item">
            <span class="label">Fees</span>
            <span class="value" id="total-fees" style="color:var(--text-muted)">$0.00</span>
        </div>
        <div class="stat-item">
            <span class="label">Stashed</span>
            <span class="value" id="secured-profits" style="color:var(--green)">$0.00</span>
        </div>
        <div class="stat-item">
            <span class="label">Cooks</span>
            <span class="value" id="trade-count">0</span>
        </div>
        <div class="stat-item">
            <span class="label">Active Batches</span>
            <span class="value" id="open-orders">0</span>
        </div>
    </div>

    <!-- Left: Grid Levels -->
    <div class="panel grid-panel">
        <div class="panel-header">
            <span class="panel-title">Formula</span>
            <div style="display:flex;align-items:center;gap:8px">
                <span id="trailing-shifts" style="color:var(--accent);font-size:11px;display:none"></span>
                <span class="panel-title" id="grid-count" style="color:var(--text-muted)">0 levels</span>
            </div>
        </div>
        <div class="panel-body" id="grid-levels">
            <div class="empty-state">Lab is cold. Start cooking to see the formula.</div>
        </div>
    </div>

    <!-- Center: Chart + Orders -->
    <div class="center-panel">
        <div class="panel chart-panel">
            <div class="panel-header">
            <span class="panel-title">Empire Growth</span>
                <div style="display:flex;gap:4px">
                    <span class="tab active" onclick="setChartPeriod('1h')">1H</span>
                    <span class="tab" onclick="setChartPeriod('6h')">6H</span>
                    <span class="tab" onclick="setChartPeriod('24h')">24H</span>
                    <span class="tab" onclick="setChartPeriod('7d')">7D</span>
                </div>
            </div>
            <div id="chart-container">
                <canvas id="equity-chart"></canvas>
            </div>
        </div>
        <div class="panel orders-panel">
            <div class="tab-bar">
                <span class="tab active" id="tab-orders" onclick="switchTab('orders')">Open Orders</span>
                <span class="tab" id="tab-filled" onclick="switchTab('filled')">Filled</span>
                <span class="tab" id="tab-all" onclick="switchTab('all')">All Orders</span>
            </div>
            <div class="panel-body">
                <table>
                    <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Side</th>
                            <th>Price</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Time</th>
                        </tr>
                    </thead>
                    <tbody id="orders-body">
                        <tr><td colspan="6" class="empty-state">No orders</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Right: Position + Config -->
    <div class="sidebar">
        <div class="panel position-panel">
            <div class="panel-header">
                <span class="panel-title">Inventory</span>
            </div>
            <div class="position-grid">
                <div class="pos-item">
                    <div class="label">Base Balance</div>
                    <div class="value" id="base-balance">0.00000000</div>
                </div>
                <div class="pos-item">
                    <div class="label">Quote Balance</div>
                    <div class="value" id="quote-balance">$0.00</div>
                </div>
                <div class="pos-item">
                    <div class="label">Avg Entry</div>
                    <div class="value" id="avg-entry">$0.00</div>
                </div>
                <div class="pos-item">
                    <div class="label">Net P&L</div>
                    <div class="value" id="net-pnl">$0.00</div>
                </div>
            </div>
        </div>

        <div class="panel config-panel">
            <div class="panel-header">
                <span class="panel-title">Lab Controls</span>
            </div>
            <div class="panel-body">
                <div class="config-grid">
                    <div class="form-group">
                        <label>Lower Price</label>
                        <input type="number" id="cfg-lower" placeholder="55000">
                    </div>
                    <div class="form-group">
                        <label>Upper Price</label>
                        <input type="number" id="cfg-upper" placeholder="65000">
                    </div>
                    <div class="form-group">
                        <label>Levels</label>
                        <input type="number" id="cfg-levels" placeholder="20">
                    </div>
                    <div class="form-group">
                        <label>Order Size ($)</label>
                        <input type="number" id="cfg-size" placeholder="100">
                    </div>
                </div>
                <div class="config-actions">
                    <button class="btn-primary" onclick="reconfigure()">Cook</button>
                    <button class="btn-secondary" onclick="botAction('reset-halt')">Clear DEA</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ─── Futures View ─── -->
<div class="futures-view" id="futures-view">
    <div class="futures-section-header">
        <div class="futures-title">
            <span class="futures-icon">⚡</span>
            <span>Kraken Futures</span>
            <span class="futures-subtitle">Directional Grid — 3x Leverage</span>
        </div>
        <div class="futures-header-right">
            <div class="fut-stat-chip">
                <span class="label">Margin Used</span>
                <span class="value" id="fut-margin">0.0%</span>
            </div>
            <div class="status-pill status-idle" id="fut-status-pill">
                <span class="dot"></span>
                <span id="fut-status-text">LOADING</span>
            </div>
        </div>
    </div>
    <!-- Stat Bar -->
    <div class="stat-bar fut-stat-bar">
        <div class="stat-item">
            <span class="label">Account Balance</span>
            <span class="value" id="fut-balance">$0.00</span>
        </div>
        <div class="stat-item">
            <span class="label">Unrealized P&L</span>
            <span class="value" id="fut-upnl">$0.00</span>
        </div>
        <div class="stat-item">
            <span class="label">Open Positions</span>
            <span class="value" id="fut-pos-count">0</span>
        </div>
        <div class="stat-item">
            <span class="label">Active Pairs</span>
            <span class="value" id="fut-pair-count">0</span>
        </div>
        <div class="stat-item">
            <span class="label">Leverage</span>
            <span class="value" style="color:var(--crystal-blue)">3x</span>
        </div>
        <div class="stat-item">
            <span class="label">Mode</span>
            <span class="value" style="color:var(--yellow)">TESTNET</span>
        </div>
    </div>
    <div class="futures-cards" id="futures-cards">
        <div class="empty-state" style="grid-column:1/-1;padding:60px">Connecting to Kraken Futures...</div>
    </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script src="/static/app.js?v=6"></script>
</body>
</html>
